# tg2obsidian

[English](README.en.md).

## Это **форк** проекта [tg2obsidian](https://github.com/dimonier/tg2obsidian)

Для запуска без исправления под новую версию  библиотеки aiogram я добавил requirements.txt и Dockerfile чтобы запускать на сервере в контейнере.

Добавлено использование шаблона имени будущей заметки, можно использовать три параметра date, time, title где:
Title - отрезанная часть текста сообщения присланного через телеграмм. Обрезается до 32 знаков.
date - дата в формате DD-MM-YYYY
time - в формате HH-MM-SS 24H

Добавлен санитайзер имени файла созданного с помощью шаблона и уникального по параметрам.

Поправлены создания имени файлов фото и видео.

Добавлено создание предпросмотра из каждого URL в тексте сообщения.

Доработки функционала и оформления будут направлены в сторону соответствия плагина telegram-sync obsidian.

Все остальные доработки под себя и друзей будут в issue. 

## Всем добра далее частично правленый текст оригинала 

Эта программа (далее — Бот) использует бесплатную функциональность бота Telegram для сохранения сообщений из группы Telegram в хранилище [Obsidian](https://obsidian.md) на локальном компьютере.

Используемая разметка Markdown подойдёт и для большинства [других программ](https://www.markdownguide.org/tools/), работающих с локальными файлами Markdown.

## Сценарий использования

- Вы _на ходу_ пишете, наговариваете или пересылаете сообщения в личную группу Telegram
- Бот получает новые сообщения из Telegram и сохраняет их в виде заметок, таким образов формируя входящий поток информации прямо в вашем хранилище заметок
- _Позже в спокойной обстановке_ вы обрабатываете эти заметки, разнося информацию из них в подходящие места в своём хранилище

## Возможности

- Все сообщения группируются по датам — на одну дату создаётся одна заметка. Также возможно сохранять сообщения в одну единственную заметку.
- Каждое сообщение в заметке имеет заголовок с отметкой даты и времени.
- В зависимости он настроек сохраняется либо игнорируется форматирование сообщений.
- Для пересланных сообщений добавляется информация об источнике сообщения.
- Фотографии, анимации, видео и документы сохраняются в хранилище и встраиваются в заметку.
- Контакты сохраняются в виде YAML front matter и vcard.
- Для мест создаются ссылки на Google Maps и Яндекс.Карты.
- Есть возможность преобразовывать заметки с определенными ключевыми словами в задачу.
- Есть возможность тегировать заметки с определенными ключевыми словами.
- Есть возможность распознавания речи из голосовых сообщений и аудиосообщений. При этом Бот отправляет распознанный текст в виде ответа на исходное сообщение.

## Установка и настройка

Расширенные инструкции см. на странице [extended_tg2obsidian_manual.ru](extended_tg2obsidian_manual.ru.md)
1. Установите [Python](https://python.org) 3.10+.
2. Установите требуемые зависимости:

```shell
pip install aiogram=2.25.2
pip install beautifulsoup4=4.12.2
pip install lxml=4.9.3
или 
pip install -r requirements.txt
```

3. Если требуется распознавать голосовые сообщения, установите модуль [Whisper](https://github.com/openai/whisper):

```shell
pip install -U openai-whisper
```

4. Установите скомпилированный [FFMPEG](https://ffmpeg.org/download.html) и добавьте путь к исполняемому файлу (в Windows - ffmpeg.exe) в переменную окружения path. Перейдите в папку с данным скриптом и убедитесь, что ffmpeg.exe запускается из неё.
5. Создайте своего бота при помощи https://t.me/BotFather
6. Вставьте токен, полученный от `@botfather`, в соответствующую переменную в файле `config.py` и измените остальные параметры в `config.py` требуемым образом.
7. (Не обязательно). Добавьте созданного выше бота в приватную группу Telegram и сделайте администратором, чтобы он мог читать сообщения.

## Использование

1. Отправляйте/пересылайте сообщения, которые должны попасть в ваше хранилище Obsidian, в свою приватную группу Telegram или напрямую вашему боту.

2. Запустите Бота:
```shell
python tg2obsidian_bot.py
```

- На постоянно работающем компьютере или на сервере Бота можно не выключать. Тогда он будет распознавать речь и заносить заметки в Obsidian в реальном времени.
- Если вы включаете компьютер только на время использования, запускайте Бота непосредственно тогда, когда нужно получить сообщения в Obsidian, а после получения всех сообщений закрывайте программу.

**Важно!** Бот может получить сообщения только за последние 24 часа. Если от момента отправки сообщения до запуска Бота прошло более 24 часов, такое сообщение уже не будет получено Ботом.

## Дополнительно добавлено
докер файл для создания контейнера
```
docker build . -t tg2obsidian:latest

docker run -itd --name testbot -v <yourpath>/config.py:/code/config.py -v <yourpath>:<configpath> -v <yourpath>/bot.log:/code/bot.log tg2obsidian:latest
можно исползовать уже собранный образ

docker.io/deviltm/tg2obsidian:latest
```
